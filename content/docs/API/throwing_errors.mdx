---
title: Throwing Errors and Tracebacks
---

import ParamsTable from "components/params-table.tsx";

# Throwing Errors and Tracebacks

While [Call Stack Management](/docs/API/call_stack_management) handles the execution flow and context,
we need specific tools to originate and visualize errors. This
section provides the tools to throw errors, checking the error states,
and dumping traceback when error occurs.

## API

### `THROW` <Badge text="Macro" />
Wrapper for throwing an error with the current call stack.
```c
void THROW(CTB_Error ctb_error, const char *restrict msg);
```

<Callout type="info">
    Pass `""` to `msg` when error message is not needed.
</Callout>

<Callout type="warning">
    `THROW` simply records the error. It has no
    effect if you forget to do error checking.
</Callout>

#### Expands to
```c
do                                                                                 \
{                                                                                  \
    ctb_throw_error(ctb_error, __FILE__, __LINE__, __func__, msg);                 \
} while (0)
```

#### Parameters
<ParamsTable 
  params={[
    { name: "error", type: "CTB_Error", desc: "The error type." },
    { name: "msg", type: "const char*", desc: "Error message." },
  ]}
/>

#### Usage
```c
THROW(CTB_VALUE_ERROR, "");
THROW(CTB_MEMORY_ERROR, "Out of memory!");
```

### `THROW_FMT` <Badge text="Macro" />
Wrapper for raising an error with formatted message with the current call stack.
```c
void THROW_FMT(CTB_Error ctb_error, const char *restrict msg, ...);
```
<Callout type="warning">
    `THROW_FMT` simply records the error. It has no
    effect if you forget to do error checking.
</Callout>

#### Expands to
```c
do                                                                                 \
{                                                                                  \
    ctb_throw_error_fmt(                                                           \
        ctb_error, __FILE__, __LINE__, __func__, msg, __VA_ARGS__                  \
    );                                                                             \
} while (0)
```

#### Parameters
<ParamsTable 
  params={[
    { name: "error", type: "CTB_Error", desc: "The error type." },
    { name: "msg", type: "const char*", desc: "Error message." },
    { name: "...", type: "N/A", desc: "Additional arguments for formatting the message." },
  ]}
/>

#### Usage
```c
#include <stdio.h>
#include "c_traceback.h"

#define FILE_PATH "../test.txt"

void open_file(const char *file_name)
{
    FILE *file = fopen(file_name, "r");
    if (!file)
    {
        THROW_FMT(CTB_FILE_NOT_FOUND_ERROR, "Failed to open file: \"%s\"", file_name);
        return;
    }
    /* Do something */
    fclose(file);
}

int main(void)
{
    TRY_GOTO(open_file(FILE_PATH), error);
    /* Do something */

    return 0;

error:
    ctb_dump_traceback();
    return 1;
}
```
##### Output
```ansi
[0;31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
[1;31mTraceback[0m [0;31m(most recent call last):[0m
  [38;5;240m(#00)[0m [38;5;240mFile "[0m[38;5;240m/home/alvinng/Desktop/c_traceback/examples/[0m[1;36mexample_open_file.c[0m[38;5;240m", line[0m [1;36m21[0m [38;5;240min[0m [1;36mmain[0m:
    [0;31mopen_file(FILE_PATH)[0m
  [38;5;240m(#01)[0m [38;5;240mFile "[0m[38;5;240m/home/alvinng/Desktop/c_traceback/examples/[0m[1;36mexample_open_file.c[0m[38;5;240m", line[0m [1;36m12[0m [38;5;240min[0m [1;36mopen_file[0m:
    [0;31m<Error thrown here>[0m
[1;31mFileNotFoundError:[0m [0;31mFailed to open file: "../test.txt"[0m
[0;31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
```

### `ctb_check_error` <Badge text="Function" />
Check if any error has occurred.
```c
bool ctb_check_error(void);
```

#### Returns
<ParamsTable 
  params={[
    { name: "error", type: "bool", desc: "Whether an error has occurred" },
  ]}
/>

#### Usage
```c
if(ctb_check_error())
{
    goto error;
}
```

### `ctb_check_error` <Badge text="Function" />
Clear all recorded errors.
```c
void ctb_clear_error(void);
```
<Callout type="warning">This function is not recommended as exception handling is not formally supported.<br />
See [No exception handling?](../articles/exception_handling)</Callout>

### `ctb_dump_traceback` <Badge text="Function" />
Dump the traceback of all recorded errors to stderr and clear errors.
```c
void ctb_dump_traceback(void);
```

#### Usage
```c
#include <stdio.h>

#include "c_traceback.h"

#define FILE_PATH "../test.txt"

void open_file(const char *file_name)
{
    FILE *file = fopen(file_name, "r");
    if (!file)
    {
        THROW_FMT(CTB_FILE_NOT_FOUND_ERROR, "Failed to open file: \"%s\"", file_name);
        return;
    }
    /* Do something */
    fclose(file);
}

int main(void)
{
    TRY_GOTO(open_file(FILE_PATH), error);
    /* Do something */

    return 0;

error:
    ctb_dump_traceback();
    return 1;
}
```

##### Output
```ansi
[0;31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
[1;31mTraceback[0m [0;31m(most recent call last):[0m
  [38;5;240m(#00)[0m [38;5;240mFile "[0m[38;5;240m/home/alvinng/Desktop/c_traceback/examples/[0m[1;36mexample_open_file.c[0m[38;5;240m", line[0m [1;36m21[0m [38;5;240min[0m [1;36mmain[0m:
    [0;31mopen_file(FILE_PATH)[0m
  [38;5;240m(#01)[0m [38;5;240mFile "[0m[38;5;240m/home/alvinng/Desktop/c_traceback/examples/[0m[1;36mexample_open_file.c[0m[38;5;240m", line[0m [1;36m12[0m [38;5;240min[0m [1;36mopen_file[0m:
    [0;31m<Error thrown here>[0m
[1;31mFileNotFoundError:[0m [0;31mFailed to open file: "../test.txt"[0m
[0;31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
```

### `ctb_log_traceback` <Badge text="Function" />
Log the traceback of all recorded errors to stderr.
```c
void ctb_log_traceback(void);
```

<Callout info="warning">You should use 
[`ctb_dump_traceback`](#ctb_dump_traceback-) unless the error
states are needed for further use.</Callout>

### `ctb_log_call_stack` <Badge text="Function" />
Log the current call stack to stderr.
```c
void ctb_log_call_stack(void);
```
